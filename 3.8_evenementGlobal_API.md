## Qu'est-ce qu'un Ã©vÃ©nement global en React ?

Un **Ã©vÃ©nement global** est un Ã©vÃ©nement que tu **Ã©coutes directement** sur `window` ou `document`, comme :

- `resize` (changement de taille de la fenÃªtre)
- `scroll`
- `keydown` (hors composants spÃ©cifiques)
- `mousemove`

ğŸ’¡ **Important** : Ces Ã©vÃ©nements doivent toujours Ãªtre **nettoyÃ©s** pour Ã©viter des fuites mÃ©moire ou des effets indÃ©sirables quand le composant se dÃ©monte.

---

### ğŸ›  Exemple concret : Ã©couter le redimensionnement de la fenÃªtre

ğŸ“Œ **Ã‰tape 1 : CrÃ©er un Ã©tat pour stocker la largeur de lâ€™Ã©cran**

Dans `Calculator.jsx` :

```jsx
const [windowWidth, setWindowWidth] = React.useState(window.innerWidth);
```

ğŸ“Œ **Ã‰tape 2 : Ajouter un useEffect pour Ã©couter `resize`**

Toujours dans `Calculator.jsx` :

```jsx
React.useEffect(() => {
  const handleResize = () => {
    setWindowWidth(window.innerWidth);
  };

  window.addEventListener('resize', handleResize);

  // ğŸ§¼ Nettoyage propre
  return () => {
    window.removeEventListener('resize', handleResize);
  };
}, []);
```

ğŸ“Œ **Ã‰tape 3 : Afficher la largeur de la fenÃªtre**

Ajoute ceci au dÃ©but du return :

```jsx
<p style={{ fontSize: '12px', color: 'gray', textAlign: 'center' }}>
  Largeur de lâ€™Ã©cran : {windowWidth}px
</p>
```

---

### Autre application

ğŸ¯ **Objectif** :

* Utiliser `window.addEventListener("online")` et `window.addEventListener("offline")`.
* GÃ©rer le statut de connexion de lâ€™utilisateur.
* Afficher un message **en temps rÃ©el** si la calculatrice est en ligne ou hors ligne.

ğŸ›  **Ã‰tapes concrÃ¨tes dans `Calculator.jsx`**:

1. **Ajouter un nouvel Ã©tat pour le statut rÃ©seau**:

```jsx
const [isOnline, setIsOnline] = React.useState(navigator.onLine);
```
* `navigator.onLine` retourne `true` ou `false` selon que lâ€™utilisateur est connectÃ©.

---

2. **Utiliser `useEffect` pour Ã©couter `online` et `offline`**:

```jsx
React.useEffect(() => {
  const handleOnline = () => setIsOnline(true);
  const handleOffline = () => setIsOnline(false);

  window.addEventListener('online', handleOnline);
  window.addEventListener('offline', handleOffline);

  // Nettoyage
  return () => {
    window.removeEventListener('online', handleOnline);
    window.removeEventListener('offline', handleOffline);
  };
}, []);
```

âœ… Ce hook va sâ€™activer une seule fois au montage et suivre les changements de connexion rÃ©seau.

---

3. **Afficher le statut Ã  lâ€™Ã©cran**:

Ajoute ce bloc tout en haut du JSX :

```jsx
<div style={{
  backgroundColor: isOnline ? '#d4edda' : '#f8d7da',
  color: isOnline ? '#155724' : '#721c24',
  padding: '8px',
  borderRadius: '4px',
  textAlign: 'center',
  marginBottom: '10px',
  fontSize: '14px'
}}>
  {isOnline ? 'Vous Ãªtes en ligne âœ…' : 'Vous Ãªtes hors ligne âŒ'}
</div>
```

---

## API

* Nous allons utiliser `fetch()` pour appeler une **API depuis ta calculatrice**.
* Afficher une valeur rÃ©cupÃ©rÃ©e en ligne, comme :
  * Un taux de change.
  * Une valeur mathÃ©matique spÃ©ciale (`pi`, `e`, etc.).
  * Une conversion (ex: Celsius â†’ Fahrenheit).

### ğŸ“Œ Exemple simple : appeler une API publique de maths

Utilisons cette API gratuite :

ğŸ§® **MathTools API (mock)** :

`https://api.mathjs.org/v4/?expr=pi` â†’ te retourne `3.1415926535...`.

ğŸ›  **Ã‰tapes Ã  suivre dans `Calculator.jsx`**:

1. **Ajouter un Ã©tat pour stocker la valeur**:

```jsx
const [piValue, setPiValue] = React.useState(null);
```

2. **CrÃ©er une fonction pour appeler l'API**:

```jsx
const fetchPi = async () => {
  try {
    const response = await fetch('https://api.mathjs.org/v4/?expr=pi');
    const data = await response.text();
    setPiValue(data);
  } catch (error) {
    setErrorMessage("Erreur lors de la rÃ©cupÃ©ration de Ï€.");
  }
};
```

3. **Ajouter un bouton pour dÃ©clencher lâ€™appel**:

```jsx
<div style={{ marginTop: '10px', textAlign: 'center' }}>
  <button onClick={fetchPi}>ğŸ“¡ Charger Ï€ depuis API</button>
  {piValue && (
    <p style={{ fontSize: '14px', marginTop: '5px' }}>
      Valeur de Ï€ : <strong>{piValue}</strong>
    </p>
  )}
</div>
```

ğŸ” **Bonus : Appel conditionnel si en ligne**:

```js
if (!navigator.onLine) {
  setErrorMessage("Pas de connexion. Impossible d'appeler l'API.");
  return;
}
```

---

### ğŸ¯ Notre calculatrice va passer au niveau supÃ©rieur

**Lâ€™API quâ€™on va utiliser** :

ğŸ‘‰ `Math.js API` (gratuite, sans clÃ©).

Exemples de requÃªtes :

* `https://api.mathjs.org/v4/?expr=2^5` â†’ `32`.
* `...expr=sqrt(81)` â†’ `9`.
* `...expr=log(100,10)` â†’ `2`.

### ğŸ¯ Objectif de la transformation

* Ajouter un **champ de saisie manuelle** (tu lâ€™as dÃ©jÃ , on va lâ€™utiliser).
* Envoyer ce champ Ã  **Math.js API**.
* Afficher le **rÃ©sultat calculÃ©**.
* Afficher des messages en cas dâ€™erreur.

---

### ğŸ›  Ã‰tapes Ã  implÃ©menter

1. **RÃ©utiliser lâ€™input contrÃ´lÃ© existant**:

```jsx
const [manualInput, setManualInput] = React.useState('');
```

Et le champ :

```jsx
<input
  type="text"
  value={manualInput}
  onChange={(e) => setManualInput(e.target.value)}
  placeholder="Ex: sqrt(16) + log(100)"
  style={{ width: '100%', padding: '6px', marginBottom: '10px' }}
/>
```

2. **CrÃ©er une fonction `fetchAdvancedCalculation()`**:

```jsx
const fetchAdvancedCalculation = async () => {
  if (!manualInput) return;
  if (!navigator.onLine) {
    setErrorMessage("Pas de connexion internet.");
    return;
  }

  try {
    const encodedExpr = encodeURIComponent(manualInput);
    const response = await fetch(`https://api.mathjs.org/v4/?expr=${encodedExpr}`);
    const result = await response.text();
    setResult(result);
    setErrorMessage("");
  } catch (error) {
    setErrorMessage("Erreur lors du calcul scientifique.");
  }
};

// âœ¨ Exemples Ã  tester dans le champ
// sqrt(81) + 2^3
// sin(pi / 2)
// log(100, 10)
// abs(-7) * 3
```

3. **Ajouter un bouton pour dÃ©clencher le calcul scientifique**:

```jsx
<button onClick={fetchAdvancedCalculation} style={{ marginBottom: '10px' }}>
  Calculer via Math.js API ğŸ§ 
</button>
```